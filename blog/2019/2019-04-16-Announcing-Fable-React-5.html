<html class="has-navbar-fixed-top" lang="en"><head><title>Fable · Announcing Fable.React 5</title><meta http-equiv="content-type" content="text/html; charset=UTF-8" charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" type="text/css" href="/style.css"/><script src="https://unpkg.com/scroll-into-view-if-needed@2.2.28/umd/scroll-into-view-if-needed.min.js"></script></head><body><nav class="navbar is-fixed-top is-spaced"><div class="container"><div class="navbar-brand"><a class="navbar-item title is-4" href="https://fable.io/">Fable</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/docs">Documentation</a><a class="navbar-item is-hidden-mobile" href="/repl/">Try</a><a class="navbar-item is-active" href="/blog/index.html">Blog</a><a class="navbar-item is-hidden-mobile" href="/community.html">Community</a><a class="navbar-item is-hidden-mobile" href="/resources.html">Resources</a><div class="navbar-item navbar-burger-dots is-hidden-tablet"><svg height="4" stroke="none" viewBox="0 0 22 4" width="22"><circle cx="2" cy="2" r="2"></circle><circle cx="2" cy="2" r="2" transform="translate(9,0)"></circle><circle cx="2" cy="2" r="2" transform="translate(18,0)"></circle></svg></div></div><div class="navbar-end is-hidden-mobile"><a class="navbar-item" href="https://github.com/fable-compiler/fable"><span class="icon"><i class=" fab fa-github fa-lg"></i></span></a><a class="navbar-item" href="https://twitter.com/FableCompiler"><span class="icon"><i class=" fab fa-twitter fa-lg"></i></span></a><a class="navbar-item" href="https://gitter.im/fable-compiler/Fable"><span class="icon"><i class=" fab fa-gitter fa-lg"></i></span></a><a class="navbar-item" href="https://www.youtube.com/channel/UC6m70Jyr65ogDySbK7aMmzg/videos"><span class="icon"><i class=" fab fa-youtube fa-lg"></i></span></a></div></div><div class="nacara-navbar-menu"><a class="nacara-navbar-menu-item" href="/repl/">Try</a><a class="nacara-navbar-menu-item" href="/community.html">Community</a><a class="nacara-navbar-menu-item" href="/resources.html">Resources</a><a class="nacara-navbar-menu-item" href="https://github.com/fable-compiler/fable">Github</a><a class="nacara-navbar-menu-item" href="https://twitter.com/FableCompiler">Twitter</a><a class="nacara-navbar-menu-item" href="https://gitter.im/fable-compiler/Fable">Gitter</a><a class="nacara-navbar-menu-item" href="https://www.youtube.com/channel/UC6m70Jyr65ogDySbK7aMmzg/videos">Youtube</a></div></div></nav><div class="grey-overlay"></div><div class="nacara-content"><div class="container"><div class="columns"><div class="column is-8-desktop is-offset-2-desktop"><div class="section blog-post"><figure class="image is-96x96 author-image"><img class="is-rounded" src="https://github.com/alfonsogarciacaro.png"/></figure><h2 class="title is-size-3 has-text-primary has-text-weight-normal has-text-centered blog-title">Announcing Fable.React 5</h2><div class="tags has-addons is-justify-content-center"><a class="tag is-rounded is-medium is-primary" href="https://twitter.com/alfonsogcnunez">Alfonso García-Caro</a><span class="tag is-rounded is-medium">April 16, 2019</span></div><div class="content"><style class=grvsc-styles>.grvsc-container{overflow:auto;position:relative;-webkit-overflow-scrolling:touch;padding-top:1rem;padding-top:var(--grvsc-padding-top,var(--grvsc-padding-v,1rem));padding-bottom:1rem;padding-bottom:var(--grvsc-padding-bottom,var(--grvsc-padding-v,1rem));border-radius:8px;border-radius:var(--grvsc-border-radius,8px);font-feature-settings:normal;line-height:1.4}.grvsc-code{display:table}.grvsc-line{display:table-row;box-sizing:border-box;width:100%;position:relative}.grvsc-line>*{position:relative}.grvsc-gutter-pad{display:table-cell;padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem))/ 2)}.grvsc-gutter{display:table-cell;-webkit-user-select:none;-moz-user-select:none;user-select:none}.grvsc-gutter::before{content:attr(data-content)}.grvsc-source{display:table-cell;padding-left:1.5rem;padding-left:var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem));padding-right:1.5rem;padding-right:var(--grvsc-padding-right,var(--grvsc-padding-h,1.5rem))}.grvsc-source:empty::after{content:' ';-webkit-user-select:none;-moz-user-select:none;user-select:none}.grvsc-gutter+.grvsc-source{padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem))/ 2)}.grvsc-has-line-highlighting>.grvsc-code>.grvsc-line::before{content:' ';position:absolute;width:100%}.grvsc-line-diff-add::before{background-color:var(--grvsc-line-diff-add-background-color,rgba(0,255,60,.2))}.grvsc-line-diff-del::before{background-color:var(--grvsc-line-diff-del-background-color,rgba(255,0,20,.2))}.grvsc-line-number{padding:0 2px;text-align:right;opacity:.7}.atom-one-light{background-color:#fafafa;color:#383a42}.atom-one-light .mtki{font-style:italic}.atom-one-light .mtk14{color:#a626a4}.atom-one-light .mtk1{color:#383a42}.atom-one-light .mtk9{color:#4078f2}.atom-one-light .mtk5{color:#e45649}.atom-one-light .mtk4{color:#c18401}.atom-one-light .mtk7{color:#a0a1a7}.atom-one-light .mtk6{color:#986801}.atom-one-light .mtk10{color:#50a14f}.atom-one-light .grvsc-line-highlighted::before{background-color:var(--grvsc-line-highlighted-background-color,rgba(0,0,0,.05));box-shadow:inset var(--grvsc-line-highlighted-border-width,4px) 0 0 0 var(--grvsc-line-highlighted-border-color,rgba(0,0,0,.2))}</style><p>Fable.React 5 has just been released with new additions to help write your Fable/Elmish apps with React. Before going into detail, I want to thank Julien Roncaglia (@vbfox) who has contributed most of the ideas for this release since <a href="https://www.youtube.com/watch?v=9VJoaNoutm4">his talk at latest FableConf</a>, as well as the React team for their great work in the latest releases. And also to Don Syme and the other F# compiler contributors who have added features like anonymous records to make F# even more suitable to write UIs!<blockquote><p>Note this release depends on Fable.Core 3 and Fable.Browser.Dom, please <a href=https://fable.io/blog/Announcing-2-2.html>read the previous post</a> to learn about the changes in the ecosystem.</blockquote><p>So far, in Elmish applications the most common way to render the UI was to use simple functions, which is great and shows the power of Functional Programming for building UIs. However, in order to use React features like keeping internal state or getting a reference to the actual element in the browser's DOM, we had to declare a full class component. It worked, but required quite a bit of code to turn the view functions into classes and override the proper methods.<p>This is about to end since React 16.8 and the introduction of <a href=https://reactjs.org/docs/hooks-overview.html>hooks</a> which gives function components the same possibilities as class components have. Fable.React 5 focus on this and, in fact, from now on it may be difficult to tell functions from function components apart, so let's learn more about what distinguishes them.<h2>Functions vs Function Components</h2><p>Functions are <strong>just functions</strong> (I'm also in a position to confirm water is wet): each time you call them, their code is run, you get a value in return and forget about them.<pre class="atom-one-light grvsc-container"data-index=0 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>open</span><span class=mtk1> </span><span class=mtk9>Fable.React</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>myView</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>props</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>MyProps</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    div </span><span class=mtk14>[]</span><span class=mtk1> </span><span class=mtk14>[</span><span class=mtk1>str props.message</span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class="mtk7 mtki">// We could just replace the call to myView with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class="mtk7 mtki">// the body of the function and get the same result</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>rootView</span><span class=mtk1> msg </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    myView </span><span class=mtk14>{</span><span class=mtk1> message </span><span class=mtk14>=</span><span class=mtk1> msg </span><span class=mtk14>}</span></span></span></code></pre><p>On the other hand, function components are <strong>actual entities</strong> in the Virtual DOM, which means you can visualize them in the React dev tools or include triggers for different moments of the component's life cycle. In Fable.React 5 we use the <code>FunctionComponent</code> helper to declare them. The signature is the same as that of a function <code>'Props -> ReactElement</code> so, as a convention, we will use <strong>upper case to name them</strong> and highlight them over simple functions.<pre class="atom-one-light grvsc-container"data-index=1 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>MyView</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    FunctionComponent.Of</span><span class=mtk14>(fun</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>props</span><span class=mtk14>:</span><span class=mtk4> Props</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        div </span><span class=mtk14>[]</span><span class=mtk1> </span><span class=mtk14>[</span><span class=mtk1>str props.message</span><span class=mtk14>])</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>rootView</span><span class=mtk1> msg </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    MyView </span><span class=mtk14>{</span><span class=mtk1> message </span><span class=mtk14>=</span><span class=mtk1> msg </span><span class=mtk14>}</span></span></span></code></pre><blockquote><p>This distinction is not exactly the same in React, because React apps usually use JSX for the UI code so the difference radicates in <em>the way you call the function</em>. Because Fable apps just use F#, we need the <code>FunctionComponent</code> wrapper to get the desired behavior.</blockquote><p>When to use a function component? Whenever you need:<ul><li>To <strong>skip rendering</strong> the component if the props haven't changed. This is specially important when using central state management like Elmish, because every time our UI model is updated a new render for the whole app will be triggered. Skip the parts of the UI tree that don't need to change with the <code>memoizeWith</code> parameter, which receives a function to check if the old and new props are equal. Fable.React 5 also provides the <code>equalsButFunctions</code> helper which doesn't take into account the functions in the props object (useful in Elmish apps where we usually pass the <code>dispatch</code> function down the UI tree).</ul><pre class="atom-one-light grvsc-container"data-index=2 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>MyView</span><span class=mtk1>  </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    FunctionComponent.Of</span><span class=mtk14>((fun</span><span class=mtk1> p </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk14>..),</span><span class=mtk1> memoizeWith </span><span class=mtk14>=</span><span class=mtk1> equalsButFunctions</span><span class=mtk14>)</span></span></span></code></pre><ul><li><p>To keep some <strong>internal state</strong> for the component, which can be done using React's state hook. Hooks also give you more capabilities concerning the component's life cycle. Read more about them in the next section.<li><p>To <strong>visualize the component</strong> in React dev tools, very helpful for debugging. Use the <code>displayName</code> parameter to set a custom name for the component in React dev tools.</ul><h2>React Hooks</h2><p>In Elmish apps we keep a central model for our whole app so most of the times we don't need stateful React components.<pre class="atom-one-light grvsc-container"data-index=3 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>view</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>props</span><span class=mtk14>:</span><span class=mtk4> </span><span class=mtk14>{|</span><span class=mtk1> count</span><span class=mtk14>:</span><span class=mtk4> int</span><span class=mtk14>;</span><span class=mtk1> dispatch</span><span class=mtk14>:</span><span class=mtk4> int </span><span class=mtk14>-></span><span class=mtk4> unit </span><span class=mtk14>|})</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>      button</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>[</span><span class=mtk1> OnClick </span><span class=mtk14>(fun</span><span class=mtk1> _ </span><span class=mtk14>-></span><span class=mtk1> props.count </span><span class=mtk14>+</span><span class=mtk1> </span><span class=mtk6>1</span><span class=mtk1> </span><span class=mtk14>|></span><span class=mtk1> props.dispatch</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>[</span><span class=mtk1> str </span><span class=mtk10>"Times clicked: "</span><span class=mtk14>;</span><span class=mtk1> ofInt props.count </span><span class=mtk14>]</span></span></span></code></pre><p>In some occasions however we don't want to include some very specific internal state in the global model (e.g. whether a dropdown is open or closed), and in order to do that we need to deploy a full class. The example above would become:<pre class="atom-one-light grvsc-container"data-index=4 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Props</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk14>{</span><span class=mtk1> initCount</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>int </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>State</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk14>{</span><span class=mtk1> count</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>int </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>MyView</span><span class=mtk14>(</span><span class=mtk1>props</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>inherit</span><span class=mtk1> Component</span><span class=mtk14>&lt;</span><span class=mtk1>Props</span><span class=mtk14>,</span><span class=mtk1> State</span><span class=mtk14>>(</span><span class=mtk1>props</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>do</span><span class=mtk1> </span><span class=mtk14>base</span><span class=mtk1>.setInitState</span><span class=mtk14>({</span><span class=mtk1> count </span><span class=mtk14>=</span><span class=mtk1> props.initCount </span><span class=mtk14>})</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>override</span><span class=mtk1> </span><span class=mtk5>this.render</span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>          button</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>[</span><span class=mtk1> OnClick </span><span class=mtk14>(fun</span><span class=mtk1> _ </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                this.setState</span><span class=mtk14>(fun</span><span class=mtk1> s _ </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk14>{</span><span class=mtk1> s </span><span class=mtk14>with</span><span class=mtk1> count </span><span class=mtk14>=</span><span class=mtk1> s.count </span><span class=mtk14>+</span><span class=mtk1> </span><span class=mtk6>1</span><span class=mtk1> </span><span class=mtk14>}))</span><span class=mtk1> </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>[</span><span class=mtk1> str </span><span class=mtk10>"Times clicked: "</span><span class=mtk14>;</span><span class=mtk1> ofInt this.state.count </span><span class=mtk14>]</span></span></span></code></pre><p>The situation gets more complicated when we also want to trigger some code at specific points in the life cycle, keep a reference to value outside the component state, etc. Thankfully, since React 16.8 we can use hooks to empower functions with all these capabilities. Now adding state to a component is as simple as:<pre class="atom-one-light grvsc-container"data-index=5 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>view</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    FunctionComponent.Of</span><span class=mtk14>(fun</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>props</span><span class=mtk14>:</span><span class=mtk4> </span><span class=mtk14>{|</span><span class=mtk1> initCount</span><span class=mtk14>:</span><span class=mtk4> int </span><span class=mtk14>|})</span><span class=mtk1> </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>state</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> Hooks.useState</span><span class=mtk14>(</span><span class=mtk1>props.initCount</span><span class=mtk14>)</span><span class=mtk1> </span><span class="mtk7 mtki">// This is where the magic happens</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    button</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>[</span><span class=mtk1> OnClick </span><span class=mtk14>(fun</span><span class=mtk1> _ </span><span class=mtk14>-></span><span class=mtk1> state.update</span><span class=mtk14>(fun</span><span class=mtk1> s </span><span class=mtk14>-></span><span class=mtk1> s </span><span class=mtk14>+</span><span class=mtk1> </span><span class=mtk6>1</span><span class=mtk14>))</span><span class=mtk1> </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>[</span><span class=mtk1> str </span><span class=mtk10>"Times clicked: "</span><span class=mtk14>;</span><span class=mtk1> ofInt state.current </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>)</span></span></span></code></pre><p>I won't explain hooks in detail because <a href=https://reactjs.org/docs/hooks-overview.html>React documentation is already a fantastic source</a> for that. Fable.React 5 provides bindings for the most commonly used hooks (<code>useState</code>, <code>useEffect</code>, <code>useRef</code>, <code>useMemo</code>...) matching React's API for the most part, except for a few cases where a different name is necessary to comply with F# overloading rules. I will only show another example combining <code>useEffect</code> and <code>useRef</code> to detect a click <em>outside</em> our component, something that beforehand required quite a bit of code.<pre class="atom-one-light grvsc-container"data-index=6 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>open</span><span class=mtk1> </span><span class=mtk9>Browser.Types</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>attachEvent</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>f</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Event</span><span class=mtk14>-></span><span class=mtk4>unit</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>node</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Node</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>eventType</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>string</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    node.addEventListener</span><span class=mtk14>(</span><span class=mtk1>eventType</span><span class=mtk14>,</span><span class=mtk1> f</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>{</span><span class=mtk1> </span><span class=mtk14>new</span><span class=mtk1> System.IDisposable </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>member</span><span class=mtk1> </span><span class=mtk5>__.Dispose</span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> node.removeEventListener</span><span class=mtk14>(</span><span class=mtk1>eventType</span><span class=mtk14>,</span><span class=mtk1> f</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>view</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    FunctionComponent.Of</span><span class=mtk14>(fun</span><span class=mtk1> props </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class="mtk7 mtki">// Keep a value ref during component's life cycle, initialized to None</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>selfRef</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> Hooks.useRef None</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class="mtk7 mtki">// Passing an empty array for dependencies tells React the effect should</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class="mtk7 mtki">// only run when mounting (and the disposable when unmounting)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        Hooks.useEffectDisposable</span><span class=mtk14>((fun</span><span class=mtk1> </span><span class=mtk14>()</span><span class=mtk1> </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>(</span><span class=mtk1>Browser.Dom.document</span><span class=mtk14>,</span><span class=mtk1> </span><span class=mtk10>"mousedown"</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>||></span><span class=mtk1> attachEvent </span><span class=mtk14>(fun</span><span class=mtk1> ev </span><span class=mtk14>-></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>menuEl</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Element </span><span class=mtk14>=</span><span class=mtk1> selfRef.current.Value</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                </span><span class=mtk14>if</span><span class=mtk1> </span><span class=mtk14>not(</span><span class=mtk1>menuEl.contains</span><span class=mtk14>(</span><span class=mtk1>ev.target </span><span class=mtk14>:?></span><span class=mtk1> </span><span class=mtk14>_))</span><span class=mtk1> </span><span class=mtk14>then</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>                    printfn </span><span class=mtk10>"Clicked outside!"</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>),</span><span class=mtk1> </span><span class=mtk14>[||])</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        button</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class="mtk7 mtki">// We can pass the ref object directly to the new RefHook prop</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class="mtk7 mtki">// to get a reference to the actual button element in the browser's doom</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>[</span><span class=mtk1> RefHook selfRef</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>              OnClick </span><span class=mtk14>(fun</span><span class=mtk1> _ </span><span class=mtk14>-></span><span class=mtk1> printfn </span><span class=mtk10>"Clicked inside!"</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>[</span><span class=mtk1> str </span><span class=mtk10>"Click me"</span><span class=mtk1> </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>)</span></span></span></code></pre><h2>Type-safe CSS props</h2><p>The following CSS props now accept a union type instead of a simple string for better type safety and discoverability. Thanks to Zaid-Ajaj for this contribution!<ul><li>Display<li>Position<li>TextAlign<li>AlignContent<li>AlignItems<li>AlignSelf</ul><pre class="atom-one-light grvsc-container"data-index=7 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>div </span><span class=mtk14>[</span><span class=mtk1> Display DisplayOptions.Flex </span><span class=mtk14>]</span><span class=mtk1> </span><span class=mtk14>[</span><span class=mtk1> </span><span class=mtk14>]</span></span></span></code></pre><h2>Code Splitting</h2><p>Fable.React 5 also includes initial support for "code splitting", that is, split your JS bundle in order to defer the download of parts that are not immediately accessible to the user (a very handy feature in Single Page Applications). So far, this has been quite tricky in Fable apps: we had to create a separate project and import it manually using a string. Fable.React 5 includes <code>FunctionComponent.Lazy</code> which can automatically defer the download of the code for a React component with minimum changes to your code.<blockquote><p>IMPORTANT: For this feature to work you need <code>fable-compiler</code> (npm) 2.3 or higher.</blockquote><pre class="atom-one-light grvsc-container"data-index=8 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class="mtk7 mtki">// About.fs</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>view</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>props</span><span class=mtk14>:</span><span class=mtk4> </span><span class=mtk14>{|</span><span class=mtk1> model</span><span class=mtk14>:</span><span class=mtk4> Model</span><span class=mtk14>;</span><span class=mtk1> dispatch</span><span class=mtk14>:</span><span class=mtk4> Msg</span><span class=mtk14>-></span><span class=mtk4>unit </span><span class=mtk14>|})</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk14>..</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class="mtk7 mtki">// Router.fs</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>AboutPage</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    FunctionComponent.Lazy</span><span class=mtk14>(</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        About.view</span><span class=mtk14>,</span><span class=mtk1> </span><span class="mtk7 mtki">// Pass a direct reference to the view function in the external file</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        fallback </span><span class=mtk14>=</span><span class=mtk1> div </span><span class=mtk14>[]</span><span class=mtk1> </span><span class=mtk14>[</span><span class=mtk1>str </span><span class=mtk10>"Loading..."</span><span class=mtk14>])</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>view</span><span class=mtk1> page </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>match</span><span class=mtk1> page </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> Home </span><span class=mtk14>-></span><span class=mtk1> HomePage </span><span class=mtk14>{|</span><span class=mtk1> </span><span class=mtk14>..</span><span class=mtk1> </span><span class=mtk14>|}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class="mtk7 mtki">// The code for About.fs will not be downloaded until</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class="mtk7 mtki">// the user selects the "About" page</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> About </span><span class=mtk14>-></span><span class=mtk1> AboutPage </span><span class=mtk14>{|</span><span class=mtk1> </span><span class=mtk14>..</span><span class=mtk1> </span><span class=mtk14>|}</span></span></span></code></pre><p>You need also to make sure your webpack config includes the following:<pre class="atom-one-light grvsc-container"data-index=9 data-language=js><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>    optimization: {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        splitChunks: {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            chunks: </span><span class=mtk10>"all"</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        },</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    },</span></span></span></code></pre><p>As you've seen, you need to pass a <strong>direct reference to the external function</strong> as first argument to <code>FunctionComponent.Lazy</code> (avoid indirections like pipes, etc) so Fable can detect the path to the external file. Also, <strong>avoid other static references to the external file</strong> as this will pull the external code into the main bundle ruining the effect of code splitting. In Elmish apps, you'll usually have to add a reference to the <code>update</code> function of the external component. This makes it difficult to completely defer the download of code for the whole component (the state logic will get bundled in the main chunk), but if you separate the code for the component's state and view into different files, as it's common practice in Elmish apps, you can still defer the download of external resources needed for the view like CSS, JS libraries, etc. Have a look at <a href=https://github.com/MangelMaxime/fulma-demo/pull/27>this PR for a real-world example</a>.<p>Another trick to avoid static references is to use an <strong>anonymous record for the props of the external view function</strong>, so Fable doesn't need to refer to the constructor of a declared record when passing the props.<hr><p>Those are the most important new features in Fable.React 5 and I hope they help make your development experience with Fable and Elmish much more enjoyable. Looking forward to seeing the awesome projects you'll build with this!</div></div></div></div></div></div><script async="" src="/resources/nacara-standard-layouts/scripts/menu.js"></script></body></html>